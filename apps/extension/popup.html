<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=400, initial-scale=1.0">
  <title>Sentinel</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="logo">
        <span class="logo-icon">üîç</span>
        <span class="logo-text">Sentinel</span>
      </div>
      <button id="settings-btn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    </header>

    <main class="main">
      <!-- Login view -->
      <div id="login-view" class="view">
        <h2 id="auth-title">Login to Sentinel</h2>
        <form id="login-form">
          <input type="email" id="email" placeholder="Email" required>
          <input type="password" id="password" placeholder="Password" required>
          <label class="remember-me">
            <input type="checkbox" id="remember-me">
            <span>Zapam√§ta≈• prihlasovacie √∫daje</span>
          </label>
          <button type="submit" class="btn btn-primary" id="auth-submit-btn">Login</button>
        </form>
        <p class="text-small text-center">
          <span id="auth-toggle-text">No account?</span>
          <a href="#" id="auth-toggle-link">Sign up</a>
        </p>
      </div>

      <!-- Picker view -->
      <div id="picker-view" class="view hidden">
        <!-- Collapsible Pick Element Section -->
        <div class="accordion" id="picker-accordion">
          <button type="button" class="accordion-header" id="picker-accordion-toggle">
            <span>üéØ Pick Element</span>
            <span class="accordion-icon">‚ñº</span>
          </button>
          <div class="accordion-content" id="picker-accordion-content">
            <div class="action-buttons">
              <button id="start-picker" class="btn btn-primary btn-large">
                <span>üéØ</span> Pick Element
              </button>
            </div>

            <div id="selection-preview" class="selection-preview hidden">
              <h4>Selected Element</h4>
              <div class="preview-selector">
                <code id="preview-selector-text"></code>
              </div>
              <div class="preview-value">
                <span class="label">Current Value:</span>
                <span id="preview-value-text"></span>
              </div>
            </div>

            <form id="create-rule-form" class="hidden">
          <h4>Create Monitoring Rule</h4>
          <input type="text" id="rule-name" placeholder="Rule name" required>
          <select id="rule-type" required>
            <option value="">Select type...</option>
            <option value="price">Price</option>
            <option value="availability">Availability</option>
            <option value="text">Text Content</option>
            <option value="number">Number</option>
          </select>
          <div class="form-row">
            <label>Re≈æim:</label>
            <select id="monitoring-mode">
              <option value="server" selected>Server monitoring</option>
              <option value="passive">Passive capture (keƒè str√°nku otvor√≠m)</option>
            </select>
          </div>
          <select id="workspace-id" required>
            <option value="">Select workspace...</option>
          </select>
          <div class="form-row">
            <label>Kontrolova≈• ka≈æd√Ωch:</label>
            <select id="interval">
              <option value="300">5 min√∫t</option>
              <option value="600">10 min√∫t</option>
              <option value="900">15 min√∫t</option>
              <option value="1800">30 min√∫t</option>
              <option value="3600" selected>1 hodinu</option>
              <option value="7200">2 hodiny</option>
              <option value="21600">6 hod√≠n</option>
              <option value="43200">12 hod√≠n</option>
              <option value="86400">24 hod√≠n</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">Create Rule</button>
            </form>
          </div>
        </div>

        <!-- My Rules Section -->
        <div class="my-rules-section">
          <h4>üìã My Rules</h4>
          <div style="margin-top: 10px;">
            <div class="text-muted text-small" style="margin-bottom: 6px;">Server monitoring</div>
            <div id="rules-list" class="rules-list">
              <p class="text-muted text-center">Loading rules...</p>
            </div>
          </div>

          <div style="margin-top: 12px;">
            <div class="text-muted text-small" style="margin-bottom: 6px;">Passive capture (local)</div>
            <div id="passive-rules-list" class="rules-list">
              <p class="text-muted text-center">Loading local rules...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Status view (hidden, kept for compatibility) -->
      <div id="status-view" class="view hidden">
      </div>

      <!-- Rule Config Modal -->
      <div id="rule-config-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>‚öôÔ∏è Nastavenia pravidla</h3>
            <button class="icon-btn modal-close" id="modal-close">‚úï</button>
          </div>
          <form id="rule-config-form">
            <input type="hidden" id="config-rule-id">

            <div class="form-group">
              <label>Upozorni≈• keƒè:</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="alert-on-change" checked>
                  <span>Hodnota sa zmen√≠</span>
                </label>
                <label class="checkbox-label" id="alert-increase-label">
                  <input type="checkbox" id="alert-on-increase">
                  <span>Cena sa zv√Ω≈°i</span>
                </label>
                <label class="checkbox-label" id="alert-decrease-label">
                  <input type="checkbox" id="alert-on-decrease">
                  <span>Cena sa zn√≠≈æi</span>
                </label>
              </div>
            </div>

            <div class="form-group" id="threshold-group">
              <label>Upozorni≈• ak hodnota:</label>
              <div class="threshold-row">
                <select id="threshold-type">
                  <option value="">Bez limitu</option>
                  <option value="above">Presiahne</option>
                  <option value="below">Klesne pod</option>
                </select>
                <input type="number" id="threshold-value" placeholder="Hodnota" step="0.01">
              </div>
            </div>

            <button type="submit" class="btn btn-primary">Ulo≈æi≈• nastavenia</button>
          </form>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>‚öôÔ∏è Settings</h3>
            <button class="icon-btn modal-close" id="settings-modal-close">‚úï</button>
          </div>
          <div class="form-group">
            <div class="text-muted text-small" id="settings-user-line"></div>
          </div>

          <div class="form-group">
            <label>Passive capture (local data)</label>
            <div class="text-muted text-small" id="passive-stats">Loading...</div>
            <div class="action-buttons" style="margin-top: 10px; gap: 8px;">
              <button type="button" class="btn" id="capture-now">Capture now (current tab)</button>
              <button type="button" class="btn" id="export-json">Export JSON</button>
              <button type="button" class="btn" id="export-jsonl">Export JSONL</button>
              <button type="button" class="btn" id="export-csv">Export CSV</button>
            </div>
            <div class="action-buttons" style="margin-top: 10px;">
              <button type="button" class="btn btn-danger" id="clear-passive-data">Clear local data</button>
            </div>
          </div>

          <div class="form-group">
            <label>Account</label>
            <div class="action-buttons">
              <button type="button" class="btn btn-primary" id="logout-btn">Logout</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <a href="https://sentinel-app-biv.pages.dev/dashboard" target="_blank">Otvori≈• Dashboard</a>
    </footer>
  </div>
  <script src="popup.js"></script>
</body>
</html>
