(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[780],{7692:function(e,t,s){Promise.resolve().then(s.bind(s,8992))},8992:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(887),a=s(3693),n=s(5189),c=s(2448),l=s(9485),i=s(8151);function d(){var e,t,s,d,o,u,h;let x=(0,c.useParams)();(0,c.useRouter)();let[m,g]=(0,a.useState)(null),[y,p]=(0,a.useState)(!0),[f,j]=(0,a.useState)(null),[N,b]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{x.id&&S(x.id)},[x.id]);let S=async e=>{try{p(!0),j(null);let t=await i.Z.getRule(e);g(t)}catch(e){j(e instanceof Error?e.message:"Failed to load rule")}finally{p(!1)}},k=e=>{if(!e)return"Never";let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4),r=Math.floor(s/60);return s<1?"Just now":s<60?"".concat(s," minutes ago"):r<24?"".concat(r," hours ago"):"".concat(Math.floor(r/24)," days ago")},C=async()=>{if(m){b(!0),w(null);try{let e=await i.Z.testRule(m.id);w(e)}catch(e){w({success:!1,errors:[e instanceof Error?e.message:"Test failed"]})}finally{b(!1)}}},T=async()=>{if(m)try{await i.Z.pauseRule(m.id),g(e=>e?{...e,enabled:!1}:null)}catch(e){j(e instanceof Error?e.message:"Failed to pause rule")}},O=async()=>{if(m)try{await i.Z.resumeRule(m.id),g(e=>e?{...e,enabled:!0}:null)}catch(e){j(e instanceof Error?e.message:"Failed to resume rule")}},P=async()=>{if(m)try{await i.Z.updateRule(m.id,{screenshotOnChange:!m.screenshotOnChange}),g(e=>e?{...e,screenshotOnChange:!e.screenshotOnChange}:null)}catch(e){j(e instanceof Error?e.message:"Failed to update screenshots setting")}};return y?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-500",children:"Loading rule..."})]})}):f||!m?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDE15"}),(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:f||"Rule not found"}),(0,r.jsx)(n.default,{href:"/dashboard",className:"text-primary-600 hover:text-primary-700 font-medium",children:"← Back to Dashboard"})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.default,{href:"/",className:"text-2xl font-bold text-primary-600",children:"Sentinel"}),(0,r.jsx)("span",{className:"ml-4 text-gray-400",children:"/"}),(0,r.jsx)(n.default,{href:"/dashboard",className:"ml-4 text-gray-600 hover:text-gray-900",children:"Dashboard"}),(0,r.jsx)("span",{className:"ml-4 text-gray-400",children:"/"}),(0,r.jsx)("span",{className:"ml-4 text-gray-900 font-medium",children:m.name})]})})})}),(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6 mb-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:m.name}),!m.enabled&&(0,r.jsx)("span",{className:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded-full",children:"Paused"})]}),(0,r.jsx)("p",{className:"mt-1 text-gray-500",children:(0,r.jsx)("a",{href:m.source.url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary-600 hover:underline",children:m.source.url})}),(0,r.jsxs)("div",{className:"mt-4 flex items-center gap-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["Type: ",(0,r.jsx)("strong",{className:"text-gray-700",children:m.ruleType})]}),(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:["Created: ",(0,r.jsx)("strong",{className:"text-gray-700",children:k(m.createdAt)})]}),(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:["Next check: ",(0,r.jsx)("strong",{className:"text-gray-700",children:k(m.nextRunAt)})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(l.Z,{score:m.healthScore,size:"lg"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:C,disabled:N,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Testing...":"Test Now"}),m.enabled?(0,r.jsx)("button",{onClick:T,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Pause"}):(0,r.jsx)("button",{onClick:O,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Resume"})]})]})]})}),v&&(0,r.jsxs)("div",{className:"rounded-lg shadow border p-4 mb-6 ".concat(v.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[(0,r.jsxs)("h3",{className:"font-medium ".concat(v.success?"text-green-800":"text-red-800"),children:["Test ",v.success?"Successful":"Failed"]}),(0,r.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Fetch Time:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:[(null===(e=v.timing)||void 0===e?void 0:e.fetchMs)||"N/A","ms"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"HTTP Status:"})," ",(0,r.jsx)("span",{className:"font-medium",children:(null===(t=v.fetch)||void 0===t?void 0:t.httpStatus)||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Extracted Value:"})," ",(0,r.jsx)("span",{className:"font-medium",children:(null===(s=v.extraction)||void 0===s?void 0:s.rawValue)||"N/A"})]})]}),v.errors&&v.errors.length>0&&(0,r.jsxs)("div",{className:"mt-2 text-red-600",children:["Errors: ",v.errors.join(", ")]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-lg shadow border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Current Value"}),(0,r.jsx)("div",{className:"text-4xl font-bold text-gray-900",children:(null===(o=m.currentState)||void 0===o?void 0:null===(d=o.lastStable)||void 0===d?void 0:d.raw)||"No data"}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Last updated: ",k(null!==(h=null===(u=m.currentState)||void 0===u?void 0:u.updatedAt)&&void 0!==h?h:null)]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Configuration"}),(0,r.jsxs)("dl",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-gray-500",children:"Selector"}),(0,r.jsx)("dd",{className:"font-mono text-xs bg-gray-100 p-2 rounded mt-1",children:m.extraction.selector})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-gray-500",children:"Method"}),(0,r.jsx)("dd",{className:"font-medium text-gray-900",children:m.extraction.method.toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-gray-500",children:"Check Interval"}),(0,r.jsxs)("dd",{className:"font-medium text-gray-900",children:["Every ",m.schedule.intervalSeconds/60," minutes"]})]}),(0,r.jsx)("div",{className:"pt-3 border-t border-gray-100",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-gray-500",children:"Screenshots"}),(0,r.jsx)("dd",{className:"text-xs text-gray-400 mt-0.5",children:"Capture on change"})]}),(0,r.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:m.screenshotOnChange,onChange:P,className:"sr-only peer"}),(0,r.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]})})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 bg-white rounded-lg shadow border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Observations"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Time"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Value"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Change"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:m.latestObservations.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:k(e.createdAt)}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.extractedRaw}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm",children:e.run.errorCode?(0,r.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs",children:e.run.errorCode}):(0,r.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:["HTTP ",e.run.httpStatus]})}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm",children:e.changeDetected?(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:e.changeKind}),e.diffSummary&&(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:e.diffSummary})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"No change"})})]},e.id))})]})})]})]})]})}},9485:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(887);function a(e){let{score:t,size:s="md",showLabel:a=!0}=e;return(0,r.jsxs)("span",{className:"inline-flex items-center rounded-full border font-medium ".concat(t>=80?"bg-green-100 text-green-800 border-green-200":t>=50?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-red-100 text-red-800 border-red-200"," ").concat({sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"}[s]),children:[(0,r.jsx)("span",{className:"font-bold",children:Math.round(t)}),a&&(0,r.jsxs)("span",{className:"ml-1 font-normal",children:["(",t>=80?"Healthy":t>=50?"Warning":"Critical",")"]})]})}},8151:function(e,t,s){"use strict";class r{setToken(e){this.token=e}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:s,...r}=t,a=s||this.token,n={"Content-Type":"application/json",...t.headers};a&&(n.Authorization="Bearer ".concat(a));let c=await fetch("".concat(this.baseUrl).concat(e),{...r,headers:n});if(!c.ok)throw Error((await c.json().catch(()=>({}))).message||"API Error: ".concat(c.status));return c.json()}async login(e,t){return this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})}async register(e,t){return this.request("/auth/register",{method:"POST",body:JSON.stringify({email:e,password:t})})}async getWorkspaces(){return this.request("/workspaces")}async getWorkspace(e){return this.request("/workspaces/".concat(e))}async createWorkspace(e){return this.request("/workspaces",{method:"POST",body:JSON.stringify(e)})}async getSources(e){return this.request("/sources?workspaceId=".concat(e))}async createSource(e){return this.request("/sources",{method:"POST",body:JSON.stringify(e)})}async getRules(e){return this.request("/rules?workspaceId=".concat(e))}async getRule(e){return this.request("/rules/".concat(e))}async createRule(e){return this.request("/rules",{method:"POST",body:JSON.stringify(e)})}async updateRule(e,t){return this.request("/rules/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async testRule(e){return this.request("/rules/".concat(e,"/test"),{method:"POST"})}async pauseRule(e){return this.request("/rules/".concat(e,"/pause"),{method:"POST"})}async resumeRule(e){return this.request("/rules/".concat(e,"/resume"),{method:"POST"})}async resetRuleHealth(e){return this.request("/rules/".concat(e,"/reset-health"),{method:"POST"})}async getAlerts(e){return this.request("/alerts?workspaceId=".concat(e))}async getNotificationChannels(e){return this.request("/notification-channels?workspaceId=".concat(e))}async getNotificationChannel(e){return this.request("/notification-channels/".concat(e))}async createNotificationChannel(e){return this.request("/notification-channels",{method:"POST",body:JSON.stringify(e)})}async updateNotificationChannel(e,t){return this.request("/notification-channels/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async deleteNotificationChannel(e){return this.request("/notification-channels/".concat(e),{method:"DELETE"})}async testNotificationChannel(e){return this.request("/notification-channels/".concat(e,"/test"),{method:"POST"})}async getHealthSummary(e){return this.request("/rules/workspace/".concat(e,"/health-summary"))}async getLowHealthRules(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return this.request("/rules/workspace/".concat(e,"/low-health?threshold=").concat(t))}constructor(e){this.token=null,this.baseUrl=e}}let a=new r("https://sentinel.taxinearme.sk/api");t.Z=a},2448:function(e,t,s){"use strict";var r=s(564);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[189,175,484,744],function(){return e(e.s=7692)}),_N_E=e.O()}]);