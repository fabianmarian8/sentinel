(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[455],{2520:function(e,t,a){Promise.resolve().then(a.bind(a,9517))},9517:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(887),s=a(3693),n=a(5189),l=a(8151),i=a(5063);let o=[{value:"email",label:"Email",icon:"\uD83D\uDCE7"},{value:"telegram",label:"Telegram",icon:"✈️"},{value:"slack",label:"Slack",icon:"\uD83D\uDCAC"},{value:"webhook",label:"Webhook",icon:"\uD83D\uDD17"}];function c(){let{user:e,isLoading:t}=(0,i.a)(),[a,c]=(0,s.useState)([]),[u,h]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[f,g]=(0,s.useState)(!1),[y,p]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[N,j]=(0,s.useState)(null);(0,s.useEffect)(()=>{!t&&e&&k()},[t,e]);let k=async()=>{try{h(!0);let e=await l.Z.getWorkspaces();0===e.length&&(e=[await l.Z.createWorkspace({name:"My Workspace",type:"ecommerce"})]);let t=e[0].id;j(t);let a=await l.Z.getNotificationChannels(t);c(a),x(null)}catch(e){x(e instanceof Error?e.message:"Failed to load data")}finally{h(!1)}},w=async e=>{try{await l.Z.updateNotificationChannel(e.id,{enabled:!e.enabled}),c(a.map(t=>t.id===e.id?{...t,enabled:!t.enabled}:t))}catch(e){x(e instanceof Error?e.message:"Failed to update channel")}},C=async e=>{if(confirm("Are you sure you want to delete this notification channel?"))try{await l.Z.deleteNotificationChannel(e),c(a.filter(t=>t.id!==e))}catch(e){x(e instanceof Error?e.message:"Failed to delete channel")}},S=async e=>{try{p(e),v(null);let t=await l.Z.testNotificationChannel(e);v({id:e,...t})}catch(t){v({id:e,success:!1,message:t instanceof Error?t.message:"Test failed"})}finally{p(null)}},q=async e=>{try{let t=await l.Z.createNotificationChannel(e);c([t,...a]),g(!1)}catch(e){throw e}};return t?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.default,{href:"/",className:"text-2xl font-bold text-primary-600",children:"Sentinel"}),(0,r.jsx)("span",{className:"ml-4 text-gray-400",children:"/"}),(0,r.jsx)(n.default,{href:"/dashboard",className:"ml-4 text-gray-500 hover:text-gray-700",children:"Dashboard"}),(0,r.jsx)("span",{className:"ml-4 text-gray-400",children:"/"}),(0,r.jsx)("span",{className:"ml-4 text-gray-900 font-medium",children:"Settings"})]})})})}),(0,r.jsxs)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("div",{className:"flex space-x-4 mb-8 border-b",children:(0,r.jsx)("button",{className:"px-4 py-2 border-b-2 border-primary-600 text-primary-600 font-medium",children:"Notification Channels"})}),m&&(0,r.jsxs)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:[m,(0,r.jsx)("button",{onClick:()=>x(null),className:"float-right text-red-500 hover:text-red-700",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Notification Channels"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Configure where you receive alerts"})]}),(0,r.jsx)("button",{onClick:()=>g(!0),className:"bg-primary-600 text-white hover:bg-primary-700 px-4 py-2 rounded-md text-sm font-medium",children:"+ Add Channel"})]}),u?(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):0===a.length?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD14"}),(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"No notification channels configured"}),(0,r.jsx)("button",{onClick:()=>g(!0),className:"text-primary-600 hover:text-primary-700 font-medium",children:"Add your first channel"})]}):(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:a.map(e=>{var t,a,s,n,l;return(0,r.jsx)("li",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{className:"text-2xl",children:(null===(t=o.find(t=>t.value===e.type))||void 0===t?void 0:t.icon)||"\uD83D\uDCE2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[e.type.charAt(0).toUpperCase()+e.type.slice(1),(null===(a=e.config)||void 0===a?void 0:a.email)&&" - ".concat(e.config.email),(null===(s=e.config)||void 0===s?void 0:s.chatId)&&" - Chat ID: ".concat(e.config.chatId),(null===(n=e.config)||void 0===n?void 0:n.channel)&&" - ".concat(e.config.channel),(null===(l=e.config)||void 0===l?void 0:l.url)&&" - ".concat(e.config.url)]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(null==b?void 0:b.id)===e.id&&(0,r.jsx)("span",{className:"text-sm ".concat(b.success?"text-green-600":"text-red-600"),children:b.message}),(0,r.jsx)("button",{onClick:()=>S(e.id),disabled:y===e.id,className:"text-gray-500 hover:text-gray-700 text-sm",children:y===e.id?"Testing...":"Test"}),(0,r.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>w(e),className:"sr-only peer"}),(0,r.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]}),(0,r.jsx)("button",{onClick:()=>C(e.id),className:"text-red-500 hover:text-red-700",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id)})})]})]}),f&&N&&(0,r.jsx)(d,{workspaceId:N,onAdd:q,onClose:()=>g(!1)})]})}function d(e){let{workspaceId:t,onAdd:a,onClose:n}=e,[l,i]=(0,s.useState)("email"),[c,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[f,g]=(0,s.useState)(""),[y,p]=(0,s.useState)(""),[b,v]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[k,w]=(0,s.useState)(!1),[C,S]=(0,s.useState)(null),q=async e=>{e.preventDefault(),S(null);let r={name:c||"".concat(l.charAt(0).toUpperCase()+l.slice(1)," Channel"),type:l,workspaceId:t};switch(l){case"email":if(!u){S("Email is required");return}r.emailConfig={email:u};break;case"telegram":if(!m){S("Chat ID is required");return}r.telegramConfig={chatId:m,botToken:f||void 0};break;case"slack":if(!y){S("Webhook URL is required");return}r.slackConfig={webhookUrl:y,channel:b||void 0};break;case"webhook":if(!N){S("Webhook URL is required");return}r.webhookConfig={url:N}}try{w(!0),await a(r)}catch(e){S(e instanceof Error?e.message:"Failed to add channel")}finally{w(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Add Notification Channel"}),(0,r.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("form",{onSubmit:q,className:"p-6 space-y-4",children:[C&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded text-sm",children:C}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Channel Type"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:o.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>i(e.value),className:"p-3 rounded-lg border text-center transition-colors ".concat(l===e.value?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"),children:[(0,r.jsx)("div",{className:"text-2xl mb-1",children:e.icon}),(0,r.jsx)("div",{className:"text-xs",children:e.label})]},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name (optional)"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"My ".concat(l.charAt(0).toUpperCase()+l.slice(1)," Notifications"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),"email"===l&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,r.jsx)("input",{type:"email",value:u,onChange:e=>h(e.target.value),placeholder:"alerts@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),"telegram"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chat ID"}),(0,r.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"123456789",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Get your chat ID from @userinfobot on Telegram"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bot Token (optional)"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>g(e.target.value),placeholder:"Use default bot if empty",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),"slack"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Webhook URL"}),(0,r.jsx)("input",{type:"url",value:y,onChange:e=>p(e.target.value),placeholder:"https://hooks.slack.com/services/...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel (optional)"}),(0,r.jsx)("input",{type:"text",value:b,onChange:e=>v(e.target.value),placeholder:"#monitoring",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),"webhook"===l&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Webhook URL"}),(0,r.jsx)("input",{type:"url",value:N,onChange:e=>j(e.target.value),placeholder:"https://your-server.com/webhook",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"We'll POST JSON data to this URL when alerts trigger"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:k,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:k?"Adding...":"Add Channel"})]})]})]})})}},5063:function(e,t,a){"use strict";a.d(t,{H:function(){return d},a:function(){return u}});var r=a(887),s=a(3693),n=a(2448),l=a(8151);let i=(0,s.createContext)(void 0),o="sentinel_token",c="sentinel_user";function d(e){let{children:t}=e,[a,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),m=(0,n.useRouter)(),x=(0,n.usePathname)();(0,s.useEffect)(()=>{let e=localStorage.getItem(o),t=localStorage.getItem(c);if(e&&t)try{let a=JSON.parse(t);d(a),l.Z.setToken(e)}catch(e){localStorage.removeItem(o),localStorage.removeItem(c)}h(!1)},[]),(0,s.useEffect)(()=>{!u&&!a&&(null==x?void 0:x.startsWith("/dashboard"))&&m.push("/login")},[a,u,x,m]);let f=async(e,t)=>{let{accessToken:a,user:r}=await l.Z.login(e,t);localStorage.setItem(o,a),localStorage.setItem(c,JSON.stringify(r)),l.Z.setToken(a),d(r),m.push("/dashboard")},g=async(e,t)=>{await l.Z.register(e,t),await f(e,t)};return(0,r.jsx)(i.Provider,{value:{user:a,isLoading:u,login:f,register:g,logout:()=>{localStorage.removeItem(o),localStorage.removeItem(c),l.Z.setToken(null),d(null),m.push("/login")}},children:t})}function u(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8151:function(e,t,a){"use strict";class r{setToken(e){this.token=e}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:a,...r}=t,s=a||this.token,n={"Content-Type":"application/json",...t.headers};s&&(n.Authorization="Bearer ".concat(s));let l=await fetch("".concat(this.baseUrl).concat(e),{...r,headers:n});if(!l.ok)throw Error((await l.json().catch(()=>({}))).message||"API Error: ".concat(l.status));return l.json()}async login(e,t){return this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})}async register(e,t){return this.request("/auth/register",{method:"POST",body:JSON.stringify({email:e,password:t})})}async getWorkspaces(){return this.request("/workspaces")}async getWorkspace(e){return this.request("/workspaces/".concat(e))}async createWorkspace(e){return this.request("/workspaces",{method:"POST",body:JSON.stringify(e)})}async getSources(e){return this.request("/sources?workspaceId=".concat(e))}async createSource(e){return this.request("/sources",{method:"POST",body:JSON.stringify(e)})}async getRules(e){return this.request("/rules?workspaceId=".concat(e))}async getRule(e){return this.request("/rules/".concat(e))}async createRule(e){return this.request("/rules",{method:"POST",body:JSON.stringify(e)})}async updateRule(e,t){return this.request("/rules/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async testRule(e){return this.request("/rules/".concat(e,"/test"),{method:"POST"})}async pauseRule(e){return this.request("/rules/".concat(e,"/pause"),{method:"POST"})}async resumeRule(e){return this.request("/rules/".concat(e,"/resume"),{method:"POST"})}async resetRuleHealth(e){return this.request("/rules/".concat(e,"/reset-health"),{method:"POST"})}async getAlerts(e){return this.request("/alerts?workspaceId=".concat(e))}async getNotificationChannels(e){return this.request("/notification-channels?workspaceId=".concat(e))}async getNotificationChannel(e){return this.request("/notification-channels/".concat(e))}async createNotificationChannel(e){return this.request("/notification-channels",{method:"POST",body:JSON.stringify(e)})}async updateNotificationChannel(e,t){return this.request("/notification-channels/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async deleteNotificationChannel(e){return this.request("/notification-channels/".concat(e),{method:"DELETE"})}async testNotificationChannel(e){return this.request("/notification-channels/".concat(e,"/test"),{method:"POST"})}async getHealthSummary(e){return this.request("/rules/workspace/".concat(e,"/health-summary"))}async getLowHealthRules(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return this.request("/rules/workspace/".concat(e,"/low-health?threshold=").concat(t))}constructor(e){this.token=null,this.baseUrl=e}}let s=new r("https://sentinel.taxinearme.sk/api");t.Z=s},2448:function(e,t,a){"use strict";var r=a(564);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[189,175,484,744],function(){return e(e.s=2520)}),_N_E=e.O()}]);