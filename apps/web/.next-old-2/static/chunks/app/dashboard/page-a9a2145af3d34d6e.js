(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8834:function(e,t,r){Promise.resolve().then(r.bind(r,8866))},8866:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(887),a=r(3693),n=r(5189),l=r(9485);function i(e){let{rule:t}=e,r=e=>{if(!e)return"Never";let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/6e4),s=Math.floor(r/60);return r<1?"Just now":r<60?"".concat(r,"m ago"):s<24?"".concat(s,"h ago"):"".concat(Math.floor(s/24),"d ago")};return(0,s.jsx)(n.default,{href:"/dashboard/rules/".concat(t.id),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 hover:shadow-lg transition-shadow p-4 cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xl",children:(e=>{switch(e){case"price":return"\uD83D\uDCB0";case"availability":return"\uD83D\uDCE6";case"text":return"\uD83D\uDCDD";case"number":return"\uD83D\uDD22";default:return"\uD83D\uDCCA"}})(t.ruleType)}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 truncate",children:t.name}),!t.enabled&&(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded-full",children:"Paused"})]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500 truncate",children:t.source.domain})]}),(0,s.jsx)(l.Z,{score:t.healthScore,size:"sm",showLabel:!1})]}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Current Value:"}),(0,s.jsx)("p",{className:"font-medium text-gray-900 truncate",children:(()=>{var e,r,s;if(!(null===(e=t.currentState)||void 0===e?void 0:e.lastStable))return"No data";let a=t.currentState.lastStable;if("object"==typeof a){if("amount"in a)return"".concat(null!==(s=a.currency)&&void 0!==s?s:"").concat(a.amount);if("inStock"in a)return a.inStock?"In Stock":"Out of Stock";if("snippet"in a)return(null===(r=a.snippet)||void 0===r?void 0:r.substring(0,50))+"..."}return String(a)})()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Observations:"}),(0,s.jsx)("p",{className:"font-medium text-gray-900",children:t.observationCount})]})]}),t.lastErrorCode&&(0,s.jsxs)("div",{className:"mt-3 p-2 bg-red-50 rounded text-sm text-red-700",children:["Last error: ",t.lastErrorCode," (",r(t.lastErrorAt),")"]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-between text-xs text-gray-400",children:[(0,s.jsxs)("span",{children:["Next check: ",r(t.nextRunAt)]}),(0,s.jsx)("span",{className:"hover:text-primary-600",children:"View Details →"})]})]})})}var o=r(5063),c=r(8151);function u(){let{user:e,logout:t,isLoading:r}=(0,o.a)(),[u,h]=(0,a.useState)([]),[m,x]=(0,a.useState)({totalRules:0,healthyRules:0,warningRules:0,criticalRules:0,averageScore:0}),[g,y]=(0,a.useState)(!0),[f,p]=(0,a.useState)(null),[b,j]=(0,a.useState)("all"),[v,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{!r&&e&&N()},[r,e]);let N=async()=>{try{y(!0),p(null);let e=await c.Z.getWorkspaces();0===e.length&&(e=[await c.Z.createWorkspace({name:"My Workspace",type:"ecommerce"})]);let t=e[0].id;w(t);try{let e=await c.Z.getRules(t);h(e);let r=e.length,s=e.filter(e=>e.healthScore>=80).length,a=e.filter(e=>e.healthScore>=50&&e.healthScore<80).length,n=e.filter(e=>e.healthScore<50).length,l=r>0?Math.round(e.reduce((e,t)=>e+t.healthScore,0)/r):0;x({totalRules:r,healthyRules:s,warningRules:a,criticalRules:n,averageScore:l})}catch(e){console.error("API error:",e),h([]),x({totalRules:0,healthyRules:0,warningRules:0,criticalRules:0,averageScore:0})}}catch(e){console.error("Failed to load workspace:",e),p("Could not connect to API. Please try again.")}finally{y(!1)}},S=u.filter(e=>"all"===b||("healthy"===b?e.healthScore>=80:"warning"===b?e.healthScore>=50&&e.healthScore<80:"critical"!==b||e.healthScore<50));return r?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(n.default,{href:"/",className:"text-2xl font-bold text-primary-600",children:"Sentinel"}),(0,s.jsx)("span",{className:"ml-4 text-gray-400",children:"/"}),(0,s.jsx)("span",{className:"ml-4 text-gray-900 font-medium",children:"Dashboard"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>alert("Use the Sentinel browser extension to create new rules.\n\n1. Install the extension\n2. Navigate to any webpage\n3. Click the Sentinel icon\n4. Select an element to monitor"),className:"bg-primary-600 text-white hover:bg-primary-700 px-4 py-2 rounded-md text-sm font-medium",children:"+ New Rule"}),(0,s.jsx)(n.default,{href:"/dashboard/settings",className:"text-gray-500 hover:text-gray-700",title:"Settings",children:(0,s.jsxs)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsx)("button",{className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e&&(0,s.jsxs)("div",{className:"flex items-center space-x-3 pl-3 border-l border-gray-200",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.email}),(0,s.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",title:"Logout",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]})]})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[f&&(0,s.jsxs)("div",{className:"mb-6 bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg flex items-center justify-between",children:[(0,s.jsx)("span",{children:f}),(0,s.jsx)("button",{onClick:N,className:"text-yellow-600 hover:text-yellow-800 font-medium",children:"Retry"})]}),g?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-500",children:"Loading dashboard..."})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)(d,{title:"Total Rules",value:m.totalRules,icon:"\uD83D\uDCCA"}),(0,s.jsx)(d,{title:"Healthy",value:m.healthyRules,icon:"✅",color:"green"}),(0,s.jsx)(d,{title:"Warning",value:m.warningRules,icon:"⚠️",color:"yellow"}),(0,s.jsx)(d,{title:"Critical",value:m.criticalRules,icon:"\uD83D\uDEA8",color:"red"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6 mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Overall Health"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Average across all rules"})]}),(0,s.jsx)(l.Z,{score:m.averageScore,size:"lg"})]}),(0,s.jsx)("div",{className:"mt-4 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-full transition-all ".concat(m.averageScore>=80?"bg-green-500":m.averageScore>=50?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(m.averageScore,"%")}})})]}),(0,s.jsx)("div",{className:"flex space-x-2 mb-6",children:["all","healthy","warning","critical"].map(e=>(0,s.jsxs)("button",{onClick:()=>j(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(b===e?"bg-primary-600 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"),children:[e.charAt(0).toUpperCase()+e.slice(1),"all"!==e&&(0,s.jsxs)("span",{className:"ml-1 text-xs opacity-75",children:["(","healthy"===e?m.healthyRules:"warning"===e?m.warningRules:m.criticalRules,")"]})]},e))}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(e=>(0,s.jsx)(i,{rule:e},e.id))}),0===S.length&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCCA"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:0===u.length?"No monitoring rules yet. Create your first rule to get started!":"No rules match the selected filter"}),0===u.length&&(0,s.jsx)("button",{onClick:()=>alert("Use the Sentinel browser extension to create new rules.\n\n1. Install the extension\n2. Navigate to any webpage\n3. Click the Sentinel icon\n4. Select an element to monitor"),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"+ Create First Rule"})]})]})]})]})}function d(e){let{title:t,value:r,icon:a,color:n}=e;return(0,s.jsxs)("div",{className:"rounded-lg shadow border p-4 ".concat(n?({green:"bg-green-50 border-green-100",yellow:"bg-yellow-50 border-yellow-100",red:"bg-red-50 border-red-100"})[n]:"bg-white border-gray-200"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-2xl",children:a}),(0,s.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:r})]}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:t})]})}},9485:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(887);function a(e){let{score:t,size:r="md",showLabel:a=!0}=e;return(0,s.jsxs)("span",{className:"inline-flex items-center rounded-full border font-medium ".concat(t>=80?"bg-green-100 text-green-800 border-green-200":t>=50?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-red-100 text-red-800 border-red-200"," ").concat({sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"}[r]),children:[(0,s.jsx)("span",{className:"font-bold",children:Math.round(t)}),a&&(0,s.jsxs)("span",{className:"ml-1 font-normal",children:["(",t>=80?"Healthy":t>=50?"Warning":"Critical",")"]})]})}},5063:function(e,t,r){"use strict";r.d(t,{H:function(){return u},a:function(){return d}});var s=r(887),a=r(3693),n=r(2448),l=r(8151);let i=(0,a.createContext)(void 0),o="sentinel_token",c="sentinel_user";function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[d,h]=(0,a.useState)(!0),m=(0,n.useRouter)(),x=(0,n.usePathname)();(0,a.useEffect)(()=>{let e=localStorage.getItem(o),t=localStorage.getItem(c);if(e&&t)try{let r=JSON.parse(t);u(r),l.Z.setToken(e)}catch(e){localStorage.removeItem(o),localStorage.removeItem(c)}h(!1)},[]),(0,a.useEffect)(()=>{!d&&!r&&(null==x?void 0:x.startsWith("/dashboard"))&&m.push("/login")},[r,d,x,m]);let g=async(e,t)=>{let{accessToken:r,user:s}=await l.Z.login(e,t);localStorage.setItem(o,r),localStorage.setItem(c,JSON.stringify(s)),l.Z.setToken(r),u(s),m.push("/dashboard")},y=async(e,t)=>{await l.Z.register(e,t),await g(e,t)};return(0,s.jsx)(i.Provider,{value:{user:r,isLoading:d,login:g,register:y,logout:()=>{localStorage.removeItem(o),localStorage.removeItem(c),l.Z.setToken(null),u(null),m.push("/login")}},children:t})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8151:function(e,t,r){"use strict";class s{setToken(e){this.token=e}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{token:r,...s}=t,a=r||this.token,n={"Content-Type":"application/json",...t.headers};a&&(n.Authorization="Bearer ".concat(a));let l=await fetch("".concat(this.baseUrl).concat(e),{...s,headers:n});if(!l.ok)throw Error((await l.json().catch(()=>({}))).message||"API Error: ".concat(l.status));return l.json()}async login(e,t){return this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})}async register(e,t){return this.request("/auth/register",{method:"POST",body:JSON.stringify({email:e,password:t})})}async getWorkspaces(){return this.request("/workspaces")}async getWorkspace(e){return this.request("/workspaces/".concat(e))}async createWorkspace(e){return this.request("/workspaces",{method:"POST",body:JSON.stringify(e)})}async getSources(e){return this.request("/sources?workspaceId=".concat(e))}async createSource(e){return this.request("/sources",{method:"POST",body:JSON.stringify(e)})}async getRules(e){return this.request("/rules?workspaceId=".concat(e))}async getRule(e){return this.request("/rules/".concat(e))}async createRule(e){return this.request("/rules",{method:"POST",body:JSON.stringify(e)})}async updateRule(e,t){return this.request("/rules/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async testRule(e){return this.request("/rules/".concat(e,"/test"),{method:"POST"})}async pauseRule(e){return this.request("/rules/".concat(e,"/pause"),{method:"POST"})}async resumeRule(e){return this.request("/rules/".concat(e,"/resume"),{method:"POST"})}async resetRuleHealth(e){return this.request("/rules/".concat(e,"/reset-health"),{method:"POST"})}async getAlerts(e){return this.request("/alerts?workspaceId=".concat(e))}async getNotificationChannels(e){return this.request("/notification-channels?workspaceId=".concat(e))}async getNotificationChannel(e){return this.request("/notification-channels/".concat(e))}async createNotificationChannel(e){return this.request("/notification-channels",{method:"POST",body:JSON.stringify(e)})}async updateNotificationChannel(e,t){return this.request("/notification-channels/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async deleteNotificationChannel(e){return this.request("/notification-channels/".concat(e),{method:"DELETE"})}async testNotificationChannel(e){return this.request("/notification-channels/".concat(e,"/test"),{method:"POST"})}async getHealthSummary(e){return this.request("/rules/workspace/".concat(e,"/health-summary"))}async getLowHealthRules(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return this.request("/rules/workspace/".concat(e,"/low-health?threshold=").concat(t))}constructor(e){this.token=null,this.baseUrl=e}}let a=new s("https://sentinel.taxinearme.sk/api");t.Z=a},2448:function(e,t,r){"use strict";var s=r(564);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[189,175,484,744],function(){return e(e.s=8834)}),_N_E=e.O()}]);